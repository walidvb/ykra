<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="image:Favicon" content="{Favicon}"/>
	<meta name="image:Info" content="{Info}"/>

	<meta name="text:Google Analytics ID" content="" />
	<link rel="shortcut icon" href="{Favicon}" type="image/x-icon">
	<link rel="icon" href="{Favicon}" type="image/x-icon">
	<title>{Title}</title>
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<meta content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1, minimal-ui" name="viewport">
	<style>
	    .info-trigger{
	        background-image: url({image:Info});
	    }
	    {CustomCSS}
	</style>
	<script>
		// Generated by CoffeeScript 1.6.2
(function() {
  var shuffleArray;

  $(function() {
    var addPosts, currentSlide, getPosts, init, insertPosts, myImage, nextSlide, timer;

    window.imgs = [];
    currentSlide = 0;
    timer = null;
    myImage = function(item, index) {
      var $this, self;

      $this = item;
      self = {};
      self.elem = item;
      self.big = $this.attr('data-big');
      self.small = $this.attr('data-small');
      self.load = function() {
        var img, src;

        src = self.big;
        img = new Image();
        img.src = src;
        console.log('Started fetching ' + src);
        img.onload = function() {
          self.elem.css('backgroundImage', "url('" + src + "')");
          return self.loaded = true;
        };
        return setTimeout(function() {
          return self.loadNext();
        }, 2000);
      };
      self.show = function(callback) {
        if (callback == null) {
          callback = null;
        }
        timer = setTimeout(function() {
          return $this.show();
        }, 500);
        self.loadNext();
        if (callback !== null) {
          return callback();
        }
      };
      self.hide = function(callback) {
        if (callback == null) {
          callback = null;
        }
        $this.hide();
        clearTimeout(timer);
        if (callback !== null) {
          return callback();
        }
      };
      self.init = function() {
        return $this.click(function() {
          nextSlide();
          return $('body').removeClass('info-open');
        });
      };
      self.index = index;
      self.loadNext = function() {
        var nextIndex, nextSlide;

        nextIndex = currentSlide + 1 >= imgs.length ? 0 : currentSlide + 1;
        nextSlide = imgs[nextIndex];
        if (!nextSlide.loaded) {
          nextSlide.load();
        }
        if (self.index === imgs.length - 1) {
          return getPosts();
        }
      };
      return self;
    };
    nextSlide = function() {
      imgs[currentSlide].hide();
      currentSlide = currentSlide + 1 >= imgs.length ? 0 : currentSlide + 1;
      return imgs[currentSlide].show();
    };
    init = function() {
      var all;

      all = shuffleArray($('.img-container'));
      addPosts(all);
      window.onresize = function() {
        return imgs[currentSlide].load();
      };
      imgs[0].load();
      return imgs[0].show();
    };
    addPosts = function(posts) {
      var offset;

      offset = imgs.length - 1;
      posts.each(function(index) {
        var i;

        i = new myImage($(this), index + offset);
        i.init();
        return imgs.push(i);
      });
      return imgs[offset + 1].load();
    };
    $('.info-trigger').click(function() {
      return $('body').toggleClass('info-open');
    });
    getPosts = function(href) {
      posts;      $.get(href, function(data) {
        var nextPage, posts;

        posts = $('.img-container', $(data));
        insertPosts(posts);
        nextPage = $('.next-page', $(data));
        return $('.next-page').replaceWith(nextPage);
      });
      return posts;
    };
    insertPosts = function(posts) {
      shuffleArray(posts);
      posts.each(function() {
        return $('.images').append($(this));
      });
      return addPosts(posts);
    };
    return init();
  });

  /*
  Randomize array element order in-place.
  Using Fisher-Yates shuffle algorithm.
  */


  shuffleArray = function(array) {
    var i, j, temp;

    i = array.length - 1;
    while (i > 0) {
      j = Math.floor(Math.random() * (i + 1));
      temp = array[i];
      array[i] = array[j];
      array[j] = temp;
      i--;
    }
    return array;
  };

}).call(this);

/*
//@ sourceMappingURL=scripts.map
*/

	</script>
</head>
<body>
	{block:IndexPage}
		<div class="images">

	    {block:Posts} 
				{block:Photo} 
					<div class="img-container" data-big="{PhotoURL-HighRes}", data-small="{PhotoURL-500}"></div>
				{/block:Photo}
				{block:Photoset} 
					{block:Photo} 
						<div class="img-container" data-big="{PhotoURL-HighRes}", data-small="{PhotoURL-500}"></div>
					{/block:Photo}
				{block:Photoset} 
		{/block:Posts} 
		</div>
		{block:NextPage}
			<a class="next-page" href="{NextPage}">next</a>
		{/block:NextPage}
	{/block:IndexPage} 
	<div class="info">
		<div class="info-details">
				<div class="left">
				Scénographie du Lieu central du festival de la Bâtie 2014
				</div>
				<div class="hidden-xs">
				réalisée par
				</div>
				<div class="right">
					<span>YKRA </span>
					<span>Youri Kravtchenko </span>
					<span class="hidden-xs">Architecte EPFL-SIA </span>
					<span class="hidden-xs">9, place des Augustins </span>
					<span class="hidden-xs">1205 Genève </span>
					<span class="hidden-xs"><a href="tel:+41787170899">078 717 08 99</a></span>
					<span><a href="mailto:y@ykra.ch", target="_blank">y@ykra.ch</a></span>
				</div>
				<div class="credits">
					<span class="type left">Photos:</span> <span class="name right">Maria Trofimova</span>
					<br>
					<span class="type left">Site:</span> <span class="name right">Walid van Boetzelaer</span>	
				</div>
		</div>
		<div class="info-trigger"></div>
	</div>

</body>
</html>